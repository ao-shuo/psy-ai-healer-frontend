# 前后端字段映射统一说明

## ✅ 统一后的字段映射

### 注册接口 (RegisterRequest / RegisterPayload)

| 字段名 | 类型 | 前端 | 后端 | 说明 |
|--------|------|------|------|------|
| username | string | ✅ | ✅ | 用户名（3-50字符） |
| password | string | ✅ | ✅ | 密码（最少6字符） |
| **fullName** | string | ✅ | ✅ | 真实姓名（统一使用fullName） |
| email | string | ✅ | ✅ | 邮箱地址 |
| role | string/enum | ✅ | ✅ | 角色：STUDENT/COUNSELOR/ADMIN |
| registrationCode | string | ✅ | ✅ | 注册码（咨询师和管理员必填） |

### 角色枚举统一

**旧版本（已废弃）：**
- ❌ USER
- ❌ THERAPIST
- ✅ ADMIN

**新版本（当前使用）：**
- ✅ STUDENT（学生用户）
- ✅ COUNSELOR（心理咨询师）
- ✅ ADMIN（系统管理员）

### 用户实体字段

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 主键 |
| username | String | 用户名（唯一） |
| password | String | 加密后的密码 |
| fullName | String | 真实姓名 |
| email | String | 邮箱 |
| **role** | Role | 单一角色（不再使用Set） |
| **enabled** | boolean | 账号是否启用（审核状态） |
| createdAt | LocalDateTime | 创建时间 |

## 🔐 注册逻辑

### 学生用户 (STUDENT)
- ✅ 无需注册码
- ✅ 注册后自动启用 (enabled=true)
- ✅ 可立即登录使用

### 心理咨询师 (COUNSELOR)
- ⚠️ 需要注册码: `counselor-2025-secret`
- ⚠️ 注册后需审核 (enabled=false)
- ⚠️ 管理员审核通过后才能登录

### 系统管理员 (ADMIN)
- ⚠️ 需要注册码: `admin-2025-secret`
- ⚠️ 注册后需审核 (enabled=false)
- ⚠️ 管理员审核通过后才能登录

## 📝 配置文件

### application.yml
```yaml
app:
  registration:
    admin-code: admin-2025-secret
    counselor-code: counselor-2025-secret
```

## 🔄 主要变更

1. **角色从集合改为单一**
   - 旧：`Set<Role> roles`
   - 新：`Role role`

2. **角色名称更新**
   - USER → STUDENT
   - THERAPIST → COUNSELOR
   - ADMIN → ADMIN（不变）

3. **添加审核机制**
   - 新增 `enabled` 字段
   - 学生自动启用
   - 咨询师和管理员需要管理员审核

4. **前端字段统一**
   - 统一使用 `fullName`（不再使用 realName）
   - 统一使用 `registrationCode`（不再使用 qualification）

## 📋 前端类型定义

```typescript
export type RegisterPayload = {
  username: string
  password: string
  fullName: string              // ✅ 统一使用
  email: string
  role?: 'STUDENT' | 'COUNSELOR' | 'ADMIN'
  registrationCode?: string     // ✅ 统一使用
}
```

## 🎯 下一步

1. ✅ 后端代码已更新完成
2. ✅ 前端 auth.ts 已更新
3. ⏭️ 需要更新前端注册表单组件
4. ⏭️ 测试三种角色的注册登录流程
